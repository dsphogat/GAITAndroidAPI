package dtw;

import java.util.ArrayList;
import java.util.Arrays;

public class dtw_test {

	/**
	 * @param args
	 */
	public static ArrayList<Double> cumtrapz(ArrayList<Double> x)
	{
		int N = x.size();
		ArrayList<Double> t = new ArrayList<Double>();
		ArrayList<Double> s = new ArrayList<Double>();
		s.add(0.0);
		for(int i=0;i<N-1;i++)
		{
			t.add(x.get(i)+x.get(i+1));
		}
		for(int i=0;i<t.size();i++)
		{
			Double temp = 0.0;
			for(int j=0;j<=i;j++)
			{
				temp = temp + t.get(j);
			}
			s.add(0.5*temp);
		}
		return s;
	}
	
	public static ArrayList<Double[]> acceltopath(ArrayList<Double[]> a)
	{
		int X=0;
		int Y=1;
		int Z=2;
		
		ArrayList<Double> x = new ArrayList<Double>();
		ArrayList<Double> y = new ArrayList<Double>();
		ArrayList<Double> z = new ArrayList<Double>();
		
		for(int i=0;i<a.size();i++)
		{
			Double[] t = a.get(i);
			x.add(t[X]);
			y.add(t[Y]);
			z.add(t[Z]);
		}
		x = cumtrapz(x);
		x = cumtrapz(x);
		
		y = cumtrapz(y);
		y = cumtrapz(y);
		
		z = cumtrapz(z);
		z = cumtrapz(z);
		
		ArrayList<Double[]> out = new ArrayList<Double[]>();
		
		for(int i=0;i<x.size();i++)
		{
			Double[] t = {x.get(i), y.get(i), z.get(i)};
			out.add(t);
		}
		return out;
	}
	
	public static double pathcost(ArrayList<Double[]> t, ArrayList<Double[]> r)
	{
		int N = t.size();
		int M = r.size();
		int X=0;
		int Y=1;
		int Z=2;
		
		Double d[][] = new Double[N][M];
		Double D[][] = new Double[N][M];
		for(int i=0;i<N;i++)
		{
			for(int j=0;j<M;j++)
			{
				d[i][j] = Math.sqrt( Math.pow((t.get(i)[X]-r.get(j)[X]),2) + Math.pow((t.get(i)[Y]-r.get(j)[Y]),2)  + Math.pow((t.get(i)[Z]-r.get(j)[Z]),2) );
				D[i][j] = 0.0;
			}
		}
		
		D[0][0] = d[0][0];
		
		for(int n=1;n<N;n++)
		{
			D[n][0]=d[n][0]+D[n-1][0];
		}
		for(int m=1;m<M;m++)
		{
			D[0][m] = d[0][m] + D[0][m-1];
		}
		
		for(int n=1;n<N;n++)
		{
			for(int m=1;m<M;m++)
			{
				D[n][m]=d[n][m]+ Math.min( Math.min(D[n-1][m], D[n-1][m-1]), D[n][m-1] );
			}
		}
		return D[N-1][M-1];	
	}
	
	public static void main(String[] args) {
		
		ArrayList<Double[]> A = new ArrayList<Double[]>();
		ArrayList<Double[]> B = new ArrayList<Double[]>();
		
		System.out.println("Starting DTW test");
		
		Double[][] s1 = {{0.4222307801246643,-0.12258315086364746,-0.2996482849121094},
				{-0.4222307801246643,-0.06810164451599121,0.1498241424560547},
				{-0.1089627742767334,0.027240753173828125,0.23154544830322266},
				{0.0,0.16344404220581055,0.04086112976074219},
				{0.06810176372528076,0.027240753173828125,-0.16344356536865234},
				{0.0,-0.06810164451599121,0.04086112976074219},
				{-0.1089627742767334,-0.04086112976074219,0.0},
				{0.0,0.1089627742767334,0.0},
				{-0.04086101055145264,-0.027240753173828125,0.04086112976074219},
				{0.0,-0.040860891342163086,0.04086017608642578},
				{0.0,0.040860891342163086,0.0},
				{-0.08172214031219482,0.027240753173828125,-0.04086017608642578},
				{0.08172214031219482,0.0,0.0},
				{0.04086101055145264,-0.027240753173828125,-0.04086112976074219},
				{0.04086101055145264,-0.040860891342163086,0.08172130584716797},
				{0.0,-0.04086112976074219,-0.04086017608642578},
				{0.027240753173828125,0.0,-0.04086112976074219},
				{0.08172202110290527,-0.1089627742767334,0.04086112976074219},
				{0.04086101055145264,0.027240753173828125,-0.04086112976074219},
				{-0.04086101055145264,0.08172202110290527,-0.04086112976074219},
				{0.0,0.08172202110290527,0.04086112976074219},
				{0.04086101055145264,0.0,0.04086112976074219},
				{0.04086112976074219,-0.08172202110290527,0.0},
				{-0.08172214031219482,-0.08172202110290527,0.08172130584716797},
				{-0.14982378482818604,0.08172202110290527,0.49033260345458984},
				{0.23154592514038086,0.04086112976074219,0.5720548629760742},
				{0.25878655910491943,-0.04086112976074219,0.5856752395629883},
				{-0.04086101055145264,-0.1089627742767334,0.49033260345458984},
				{-0.34050869941711426,-0.23154592514038086,0.7354984283447266},
				{-0.8853225708007813,-0.7354989051818848,0.8036003112792969},
				{-0.9125633239746094,-0.258786678314209,0.2996482849121094},
				{1.5663399696350098,0.8308413028717041,-0.1498241424560547},
				{1.7706452086567879,0.42223095893859863,-1.348414421081543},
				{0.2587866112589836,0.08172202110290527,-1.5254793167114258},
				{0.1634441614151001,0.29964756965637207,-1.116868019104004},
				{0.2179255485534668,0.16344428062438965,-0.9534244537353516},
				{-0.14982378482818604,0.23154592514038086,-0.9534244537353516},
				{-0.1498238444328308,0.2179255485534668,-0.6537766456604004},
				{0.2724069356918335,0.0,-0.6946377754211426},
				{-0.04086101055145264,-0.1089627742767334,-0.6401562690734863},
				{-0.2724069654941559,0.0,0.1089625358581543},
				{-0.19068486988544464,0.23154592514038086,0.29964780807495117},
				{-0.14982382580637932,0.5311934947967529,0.16344404220581055},
				{-0.34050870314240456,0.6537766456604004,1.103248119354248},
				{-1.007905751466751,0.5720546543598175,1.0760078430175781},
				{-0.4903324842453003,0.040861040353775024,0.572054386138916},
				{-0.27240705490112305,-0.1089627742767334,0.5448141098022461},
				{-0.14982366561889648,0.0,0.44947147369384766},
				{0.3405085802078247,-0.23154592514038086,-0.2996482849121094},
				{1.2258313298225403,-1.838746964931488,2.9828567504882813},
				{-1.035146415233612,-0.38136959075927734,-0.9125633239746094},
				{-1.1441092491149902,3.4050868153572083,-4.1814470291137695},
				{3.1463003754615784,0.19068485498428345,4.671779632568359},
				{1.5254788994789124,-1.4573771953582764,-2.0975341796875},
				{-0.14982378482818604,-2.260977625846863,-1.1985902786254883},
				{-0.6537766456604004,0.8036003112792969,0.5856752395629883},
				{-0.4630918502807617,1.2666923999786377,0.8036003112792969},
				{-0.4222307950258255,-0.34050869941711426,-0.31326770782470703},
				{-0.2587866112589836,-0.31326794624328613,-0.23154640197753906},
				{0.217925563454628,0.2724069356918335,0.19068527221679688},
				{0.35412903875112534,-0.04086101055145264,0.0},
				{0.29964765906333923,-0.2724069356918335,-0.1498241424560547},
				{-0.23154592514038086,0.23154592514038086,0.04086112976074219},
				{-0.29964764416217804,0.19068479537963867,0.08172225952148438},
				{0.0,-0.06810176372528076,-0.04086112976074219},
				{0.23154591023921967,-0.12258303165435791,0.0},
				{0.19068488478660583,0.0,0.0},
				{-0.04086107015609741,-0.06810176372528076,0.0},
				{0.0,0.0,-0.08172225952148438},
				{-0.1089627742767334,0.1089627742767334,0.04086112976074219},
				{-0.08172208070755005,0.04086101055145264,0.08172225952148438},
				{0.0,-0.08172202110290527,-0.04086112976074219},
				{0.08172208070755005,-0.027240753173828125,-0.04086112976074219},
				{0.06810176372528076,0.027240753173828125,0.04086112976074219},
				{-0.06810176372528076,-0.027240753173828125,-0.04086112976074219},
				{0.0,0.0,-0.04086112976074219},
				{-0.040861040353775024,0.1089627742767334,0.04086112976074219},
				{-0.040861040353775024,-0.08172202110290527,0.04086112976074219},
				{0.040861040353775024,-0.06810176372528076,0.0},
				{0.0,0.06810176372528076,0.04086112976074219},
				{-0.040861040353775024,0.0,-0.04086112976074219},
				{-0.040861040353775024,-0.027240753173828125,-0.04086112976074219},
				{-0.040861040353775024,0.027240753173828125,0.04086112976074219},
				{-0.02724069356918335,0.04086101055145264,0.0},
				{-0.040861040353775024,-0.04086101055145264,-0.04086112976074219},
				{-0.04086105525493622,0.0,0.0},
				{0.04086105525493622,0.04086101055145264,0.04086112976074219},
				{0.23154589533805847,-0.04086101055145264,0.0},
				{0.0,-0.027240753173828125,-0.04086112976074219},
				{-0.19068485498428345,0.027240753173828125,0.0},
				{0.02724069356918335,0.0,0.04086112976074219},
				{-0.06810173392295837,0.0,-0.04086112976074219},
				{-0.04086105525493622,-0.027240753173828125,0.0},
				{0.08172209560871124,0.06810176372528076,0.0},
				{-0.040861040353775024,0.0,0.04086112976074219},
				{0.040861040353775024,-0.06810176372528076,-0.04086112976074219},
				{0.02724069356918335,0.027240753173828125,0.0},
				{-0.02724069356918335,0.0,0.08172225952148438},
				{0.02724069356918335,0.0,-0.04086112976074219},
				{0.040861040353775024,0.0,0.0},
				{-0.06810173392295837,0.04086101055145264,0.0},
				{0.02724069356918335,0.04086101055145264,0.0},
				{0.12258312106132507,-0.19068479537963867,-0.04086112976074219},
				{-0.23154591023921967,0.0,0.04086112976074219},
				{-0.08172208070755005,0.29964756965637207,0.19068527221679688},
				{0.1634441763162613,-0.3813697099685669,-0.31326866149902344},
				{0.06810173392295837,0.19068491458892822,0.12258338928222656},
				{-0.06810173392295837,0.04086101055145264,0.06810188293457031},
				{-0.1634441763162613,-0.14982378482818604,-0.06810188293457031},
				{0.08172208070755005,0.08172202110290527,0.0}};
		
		Double[][] s2 = {{0.19068491458892822,-0.08172202110290527,-0.08172130584716797},
				{0.2996476888656616,-0.08172202110290527,-0.23154640197753906},
				{-0.14982390403747559,-0.027240753173828125,0.04086112976074219},
				{-0.1089627742767334,0.0,0.1089630126953125},
				{-0.04086101055145264,0.06810164451599121,0.04086112976074219},
				{0.04086101055145264,0.08172225952148438,0.0},
				{0.027240753173828125,-0.04086112976074219,-0.04086112976074219},
				{0.0,0.04086112976074219,0.0},
				{-0.027240753173828125,-0.08172225952148438,-0.027240753173828125},
				{0.0,0.0,0.027240753173828125},
				{-0.04086101055145264,0.0,0.0},
				{0.0,0.04086112976074219,0.04086112976074219},
				{-0.04086101055145264,0.04086112976074219,0.0},
				{0.0,0.0,-0.04086112976074219},
				{0.04086101055145264,0.0,0.0},
				{0.0,0.0,0.08172225952148438},
				{0.0,0.0,0.04086017608642578},
				{-0.04086101055145264,-0.04086112976074219,-0.04086017608642578},
				{0.04086101055145264,-0.08172202110290527,0.04086017608642578},
				{0.1089627742767334,-0.06810188293457031,-0.12258243560791016},
				{0.0,-0.08172202110290527,-0.027240753173828125},
				{0.12258315086364746,0.04086112976074219,-0.04086112976074219},
				{0.1089627742767334,0.0,0.06810188293457031},
				{0.0,-0.04086112976074219,-0.027240753173828125},
				{-0.1089627742767334,-0.04086112976074219,-0.12258338928222656},
				{-0.1634441614151001,0.08172225952148438,0.12258338928222656},
				{0.04086101055145264,0.040860891342163086,0.06810188293457031},
				{0.19068491458892822,-0.040860891342163086,0.0},
				{0.14982378482818604,-0.04086112976074219,-0.04086112976074219},
				{0.04086101055145264,-0.04086112976074219,-0.1089630126953125},
				{-0.1089627742767334,-0.040860891342163086,0.0},
				{-0.14982378482818604,0.040860891342163086,0.0},
				{-0.19068491458892822,0.04086112976074219,0.08172225952148438},
				{-0.04086101055145264,0.0,-0.04086112976074219},
				{0.06810176372528076,0.0,0.04086112976074219},
				{0.04086101055145264,-0.04086112976074219,0.29964733123779297},
				{0.19068491458892822,-0.06810164451599121,0.42223072052001953},
				{0.46309179067611694,0.0,0.5039529800415039},
				{0.08172208070755005,-0.27240705490112305,0.7627391815185547},
				{-0.6946377754211426,-0.23154592514038086,0.27240753173828125},
				{-0.8444615602493286,0.4630918502807617,1.334794044494629},
				{-0.23154592514038086,0.29964780807495117,0.6129150390625},
				{1.348414421081543,0.4630918502807617,-0.31326770782470703},
				{0.9942854195833206,0.14982366561889648,-0.830841064453125},
				{0.23154591768980026,0.19068503379821777,-1.035146713256836},
				{0.19068487733602524,0.0,-0.8853225708007813},
				{0.34050866961479187,-0.258786678314209,-1.116868019104004},
				{0.34050869941711426,0.0,-1.062387466430664},
				{0.0,0.29964756965637207,-1.0351462364196777},
				{-0.02724069356918335,0.3541290760040283,-0.8036007881164551},
				{0.21792560815811157,0.0,-0.5448136329650879},
				{0.31326794624328613,-0.23154592514038086,-0.42223072052001953},
				{-0.19068491458892822,0.23154592514038086,-0.027240753173828125},
				{-0.694637656211853,0.4903324842453003,0.5311932563781738},
				{-0.5720546245574951,0.38136982917785645,1.1849703788757324},
				{-0.34050869941711426,0.3813696503639221,0.9942855834960938},
				{-0.6537767052650452,-0.02724069356918335,0.7627396583557129},
				{-0.5720545649528503,-0.6129156351089478,0.8853225708007813},
				{-0.3541290760040283,0.34050869941711426,0.27240657806396484},
				{0.23154592514038086,0.23154592514038086,0.9125633239746094},
				{0.4222308397293091,-0.08172214031219482,3.9090394973754883},
				{-0.7627395391464233,0.08172214031219482,-7.08258056640625},
				{0.7627395391464233,1.7978858947753906,2.4925241470336914},
				{0.8444615006446838,-0.653776690363884,0.14982318878173828},
				{-0.34050869941711426,-1.9204690009355545,-0.5720539093017578},
				{0.8717022612690926,-0.6401563882827759,-0.6537771224975586},
				{1.389275424182415,0.7627395391464233,0.5039529800415039},
				{0.14982390403747559,0.3813697099685669,0.2587862014770508},
				{-0.34050869941711426,-0.3813697099685669,-0.34050846099853516},
				{-0.5448139309883118,0.0,-0.08172225952148438},
				{-0.6537766978144646,0.34050869941711426,0.27240753173828125},
				{-0.108962781727314,-0.14982390403747559,-0.1089630126953125},
				{0.14982382953166962,-0.04086101055145264,-0.08172225952148438},
				{0.35412903130054474,0.08172202110290527,0.08172225952148438},
				{0.2179255485534668,-0.08172202110290527,-0.04086112976074219},
				{0.0,-0.04086101055145264,0.04086112976074219},
				{-0.1089627742767334,0.12258303165435791,0.027240753173828125},
				{-0.23154589533805847,-0.08172202110290527,-0.06810188293457031},
				{-0.06810173392295837,0.0,-0.04086112976074219},
				{0.19068485498428345,0.08172202110290527,0.04086112976074219},
				{0.06810176372528076,-0.04086101055145264,0.0},
				{0.04086101055145264,-0.04086101055145264,0.04086112976074219},
				{0.04086107015609741,0.04086101055145264,-0.04086112976074219},
				{-0.12258315086364746,0.04086101055145264,-0.04086112976074219},
				{-0.1089627742767334,0.04086112976074219,0.0},
				{0.08172208070755005,-0.04086112976074219,0.04086112976074219},
				{0.06810176372528076,-0.04086101055145264,-0.04086112976074219},
				{0.04086101055145264,0.04086101055145264,0.04086112976074219},
				{0.1089627742767334,0.0,0.04086112976074219},
				{-0.1089627742767334,-0.04086101055145264,-0.08172225952148438},
				{-0.14982381463050842,0.08172214031219482,0.04086112976074219},
				{-0.040861040353775024,-0.04086112976074219,-0.04086112976074219},
				{-0.040861040353775024,0.04086112976074219,0.04086112976074219},
				{0.040861040353775024,0.0,0.0},
				{0.08172208070755005,-0.04086112976074219,0.0},
				{0.02724069356918335,0.0,0.0},
				{-0.02724069356918335,0.0,0.04086112976074219},
				{0.0,0.0,-0.08172225952148438},
				{0.0,0.0,0.04086112976074219},
				{0.1089627742767334,0.0,0.0},
				{-0.08172208070755005,0.0,-0.04086112976074219},
				{0.04086107015609741,0.04086112976074219,0.0},
				{-0.04086107015609741,-0.04086112976074219,0.0},
				{0.08172208070755005,-0.08172202110290527,0.04086112976074219},
				{0.0,0.04086101055145264,0.0},
				{0.0,0.04086101055145264,0.0},
				{0.08172208070755005,0.0,-0.04086112976074219},
				{0.1089627742767334,0.04086112976074219,0.04086112976074219},
				{0.0,-0.12258315086364746,0.0},
				{-0.4903324842453003,0.04086101055145264,-0.08172225952148438},
				{-0.12258313596248627,0.08172214031219482,0.12258338928222656},
				{0.34050868451595306,-0.08172214031219482,-0.08172225952148438},
				{0.12258315086364746,0.08172214031219482,0.08172225952148438},
				{-0.08172208070755005,-0.04086112976074219,-0.04086112976074219},
				{-0.19068488478660583,-0.04086101055145264,-0.04086112976074219},
				{0.0,0.04086101055145264,0.0}};
		
		A.addAll(Arrays.asList(s1));
		B.addAll(Arrays.asList(s2));
		
		A = acceltopath(A);
		B = acceltopath(B);
		
		double cost = pathcost(A,B);
		System.out.println("Cost:" + Double.toString(cost) + "\n");
		
	}
}
